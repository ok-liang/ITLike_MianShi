# Nginx

## 1、请解释一下什么是Nginx?
答：Nginx是一个web服务器和反向代理服务器，用于HTTP、HTTPS、SMTP、POP3和IMAP协议。

## 2、请列举Nginx的一些特性？
答：Nginx服务器的特性包括： 

 1）反向代理/L7负载均衡器 

 2）嵌入式Perl解释器 

 3）动态二进制升级 

 4）可用于重新编写URL，具有非常好的PCRE支持


## 3、nginx和apache的区别？
答： 

 1）轻量级，同样起web 服务，比apache 占用更少的内存及资源

 2）抗并发，nginx 处理请求是异步非阻塞的，而apache 则是阻塞型的，在高并发下nginx 能保持低资源低消耗高性能

 3）高度模块化的设计，编写模块相对简单 

 4）最核心的区别在于apache是同步多进程模型，一个连接对应一个进程；nginx是异步的，多个连接（万级别）可以对应一个进程


## 4.nginx是如何实现高并发的
答：一个主进程，多个工作进程，每个工作进程可以处理多个请求，每进来一个request，会有一个worker进程去处理。但不是全程的处理，处理到可能发生阻塞的地方，比如向上游（后端）服务器转发request，并等待请求返回。那么，这个处理的worker继续处理其他请求，而一旦上游服务器返回了，就会触发这个事件，worker才会来接手，这个request才会接着往下走。由于web server的工作性质决定了每个request的大部份生命都是在网络传输中，实际上花费在server机器上的时间片不多。这是几个进程就解决高并发的秘密所在。即@skoo所说的webserver刚好属于网络io密集型应用，不算是计算密集型。

## 5.请解释Nginx如何处理HTTP请求

答：Nginx使用反应器模式。主事件循环等待操作系统发出准备事件的信号，这样数据就可以从套接字读取，在该实例中读取到缓冲区并进行处理。单个线程可以提供数万个并发连接。

## 6、在Nginx中，如何使用未定义的服务器名称来阻止处理请求?

答：只需要请求删除的服务器就可以定义为：

```
 Server { 
     listen 80; server_name “ “ ; 
     return 444;
 }
```
> 这里，服务器名被保留为一个空字符串，它将在没有“主机”头字段的情况下匹配请求，而一个特殊的Nginx的非标准代码444被返回，从而终止连接。


## 7、 使用“反向代理服务器”的优点是什么?

答：反向代理服务器可以隐藏源服务器的存在和特征。它充当互联网云和web服务器之间的中间层。这对于安全方面来说是很好的，特别是当您使用web托管服务时。

## 8、请列举Nginx服务器的最佳用途。

答：Nginx服务器的最佳用法是在网络上部署动态HTTP内容，使用SCGI、WSGI应用程序服务器、用于脚本的FastCGI处理程序。它还可以作为负载均衡器。

## 9、请解释Nginx服务器上的Master和Worker进程分别是什么?
答： 

 Master进程：读取及评估配置和维持 

 Worker进程：处理请求
 
## 10、请解释你如何通过不同于80的端口开启Nginx?
答：为了通过一个不同的端口开启Nginx，你必须进入/etc/Nginx/sites-enabled/，如果这是默认文件，那么你必须打开名为“default”的文件。编辑文件，并放置在你想要的端口：

```

Like server { 
   listen 81; 
}

```

## 11、请解释是否有可能将Nginx的错误替换为502错误、503?
答： 502 =错误网关 503 =服务器超载 有可能，但是您可以确保fastcgi_intercept_errors被设置为ON，并使用错误页面指令。

```
Location / { 
	fastcgi_pass 127.0.01:9001; 		fastcgi_intercept_errors on; 
	error_page 502 =503/error_page.html;
	 #… }
```

## 12、在Nginx中，解释如何在URL中保留双斜线?
答：要在URL中保留双斜线，就必须使用merge_slashes_off; 

 语法:merge_slashes [on/off] 

 默认值: merge_slashes on 

 环境: http，server
 
## 13、请解释ngx_http_upstream_module的作用是什么?
答：ngx_http_upstream_module用于定义可通过fastcgi传递、proxy传递、uwsgi传递、memcached传递和scgi传递指令来引用的服务器组。

## 14、请解释什么是C10K问题?
答：C10K问题是指无法同时处理大量客户端(10,000)的网络套接字。

## 15、请陈述stub_status和sub_filter指令的作用是什么?
答： 

 1 Stub_status指令：该指令用于了解Nginx当前状态的当前状态，如当前的活动连接，接受和处理当前读/写/等待连接的总数   
 2 Sub_filter指令：它用于搜索和替换响应中的内容，并快速修复陈旧的数据

## 16、解释Nginx是否支持将请求压缩到上游?
答：您可以使用Nginx模块gunzip将请求压缩到上游。gunzip模块是一个过滤器，它可以对不支持“gzip”编码方法的客户机或服务器使用“内容编码:gzip”来解压缩响应。

## 17、解释如何在Nginx中获得当前的时间?
答：要获得Nginx的当前时间，必须使用SSI模块、`$date_gmt`和`$date_local`的变量。`Proxy_set_header THE-TIME $date_gmt`;
## 18、用Nginx服务器解释-s的目的是什么?
答：用于运行Nginx -s参数的可执行文件。
## 19、解释如何在Nginx服务器上添加模块?
答：在编译过程中，必须选择Nginx模块，因为Nginx不支持模块的运行时间选择

## 20反向代理和负载均衡的区别

**负载均衡**：用户请求服务器，代理部分是指做请求的转发  
**反向代理加负载均衡**：请求有两次,用户请求nginx，nginx请求服务器

## 21 为什么用Nginx？

**优点：**

- 跨平台、配置简单

- **非阻塞、高并发连接**：处理2-3万并发连接数，官方监测能支持5万并发
- **内存消耗小**：开启10个nginx才占150M内存，Nginx采取了分阶段资源分配技术
- nginx处理静态文件好,耗费内存少
- **内置的健康检查功能**：如果有一个服务器宕机，会做一个健康检查，再发送的请求就不会发送到宕机的服务器了。重新将请求提交到其他的节点上。
- 节省宽带：支持GZIP压缩，可以添加浏览器本地缓存
- 稳定性高：宕机的概率非常小
- **master/worker结构：一个master进程，生成一个或者多个worker进程**
- 接收用户请求是异步的：浏览器将请求发送到nginx服务器，它先将用户请求全部接收下来，再一次性发送给后端web服务器，极大减轻了web服务器的压力
- 一边接收web服务器的返回数据，一边发送给浏览器客户端
- 网络依赖性比较低，只要ping通就可以负载均衡
- 可以有多台nginx服务器(支持集群)
- **事件驱动：通信机制采用epoll模型**

## 22 为什么Nginx性能这么高

得益于它的事件处理机制：异步非阻塞事件处理机制：运用了epoll模型，提供了一个队列，排队解决

## 23为什么不适用多线程

**Apache:** 创建多个进程或线程，而每个进程或线程都会为其分配cpu和内存（线程要比进程小的多，所以worker支持比perfork高的并发），并发过大会榨干服务器资源。

**Nginx:** 采用单线程来异步非阻塞处理请求（管理员可以配置Nginx主进程的工作进程的数量）(epoll)，不会为每个请求分配cpu和内存资源，节省了大量资源，同时也减少了大量的CPU的上下文切换。所以才使得Nginx支持更高的并发

## 24 Nginx如何处理一个请求的

首先，nginx在启动时，会解析配置文件，得到需要监听的端口与ip地址，然后在nginx的master进程里面
    先初始化好这个监控的socket，再进行listen
    然后再fork出多个子进程出来,  子进程会竞争accept新的连接。
此时，客户端就可以向nginx发起连接了。当客户端与nginx进行三次握手，与nginx建立好一个连接后

    此时，某一个子进程会accept成功，然后创建nginx对连接的封装，即ngx_connection_t结构体
    接着，根据事件调用相应的事件处理模块，如http模块与客户端进行数据的交换。

最后，nginx或客户端来主动关掉连接，到此，一个连接就寿终正寝了

## 25为什么要做动静分离

在我们的软件开发中，有些请求是需要后台处理的（如：.jsp,.do等等），有些请求是不需要经过后台处理的（如：css、html、jpg、js等等文件）
    这些不需要经过后台处理的文件称为静态文件，否则动态文件。因此我们后台处理忽略静态文件。这会有人又说那我后台忽略静态文件不就完了吗
    当然这是可以的，但是这样后台的请求次数就明显增多了。在我们对资源的响应速度有要求的时候，我们应该使用这种动静分离的策略去解决
    动、静分离将网站静态资源（HTML，JavaScript，CSS，img等文件）与后台应用分开部署，提高用户访问静态代码的速度，降低对后台应用访问
    这里我们将静态资源放到nginx中，动态资源转发到tomcat服务器中
## 26 动态资源、静态资源分离

动态资源、静态资源分离是让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作，这就是网站静态化处理的核心思路
    动态资源、静态资源分离简单的概括是：动态文件与静态文件的分离
   
## 27 反向代理

反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求，发给内部网络上的服务器
    并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器  
    **反向代理总结就一句话：代理端代理的是服务端**
## 28正向代理

一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理  
  **正向代理总结就一句话：代理端代理的是客户端**

## 29 负载均衡

   负载均衡即是代理服务器将接收的请求均衡的分发到各服务器中
    负载均衡主要解决网络拥塞问题，提高服务器响应速度，服务就近提供，达到更好的访问质量，减少后台服务器大并发压力
